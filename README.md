# Telegram Video Analytics Bot

Telegram-–±–æ—Ç –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤–∏–¥–µ–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ (—Ä—É—Å—Å–∫–∏–π). –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –≤ SQL-–∑–∞–ø—Ä–æ—Å—ã —Å –ø–æ–º–æ—â—å—é **cloud LLM –º–æ–¥–µ–ª–∏ qwen3-coder** —á–µ—Ä–µ–∑ Ollama API.

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- [Ollama](https://ollama.com) - cloud LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä
- [Qwen3-Coder](https://github.com/QwenLM/Qwen3-Coder) - –º–æ–¥–µ–ª—å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL
- [Aiogram](https://github.com/aiogram/aiogram) - Telegram Bot framework
- [SQLAlchemy](https://www.sqlalchemy.org/) - SQL toolkit –¥–ª—è Python
- [PosgreSQL](https://www.postgresql.org/) - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

  

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ alembic/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ bot.py
‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îú‚îÄ‚îÄ db.py
‚îÇ   ‚îú‚îÄ‚îÄ const.py
‚îÇ   ‚îú‚îÄ‚îÄ llm_processor.py
‚îÇ   ‚îî‚îÄ‚îÄ models.py
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ load_data.py
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ test_llm_processor.py
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ db.json
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ init-db.sh
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ .env
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
-   Docker –∏ Docker Compose
-   Telegram Bot Token ([@BotFather](https://t.me/BotFather))
-   [Ollama API Key (cloud)](https://ollama.com/settings/keys)

### –ó–∞–ø—É—Å–∫ –∑–∞ 3 —à–∞–≥–∞
```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <your-repo-url>
cd telegram-video-analytics-bot

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –î–æ–±–∞–≤–∏—Ç—å TELEGRAM_BOT_TOKEN –∏ OLLAMA_API_KEY –≤ .env

# 3. –ü–æ–ª–æ–∂–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
mkdir -p data
cp /path/to/videos.json data/
docker-compose up -d
```
**–ì–æ—Ç–æ–≤–æ!**
- –ó–∞–ø—É—Å—Ç–∏—Ç—Å—è PostgreSQL
- –ü—Ä–∏–º–µ–Ω—è—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- –ó–∞–≥—Ä—É–∑—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ `videos.json`
- –ó–∞–ø—É—Å—Ç–∏—Ç—Å—è –±–æ—Ç–∞

  

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
# Telegram Bot
TELEGRAM_BOT_TOKEN=your_bot_token_here

# PostgreSQL - Admin credentials for migrations and data load
POSTGRES_ADMIN_USER=admin
POSTGRES_ADMIN_PASSWORD=admin_password

# PostgreSQL - Readonly credentials for bot
POSTGRES_READONLY_USER=readonly_user
POSTGRES_READONLY_PASSWORD=readonly_password

# PostgreSQL - Common settings
POSTGRES_DB=video_analytics
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# Ollama Configuration
OLLAMA_BASE_URL=https://ollama.com
OLLAMA_MODEL=qwen3-coder:480b-cloud # only cloud models required
OLLAMA_IMAGE=ollama/ollama:latest
OLLAMA_API_KEY=your_ollama_api_key_here
```
 
## Docker —Å–µ—Ä–≤–∏—Å—ã

```yaml
services:
  postgres:      # PostgreSQL 16
  migrations:    # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (admin user)
  data-loader:   # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (admin user)
  bot:           # Telegram –±–æ—Ç (readonly user, cloud LLM)
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram    ‚îÇ
‚îÇ User        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ "–°–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –Ω–∞–±—Ä–∞–ª–æ 100k –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤?"
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram Bot (aiogram)        ‚îÇ
‚îÇ - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º  ‚îÇ
‚îÇ - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ LLM processor  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ LLM Processor                 ‚îÇ
‚îÇ - –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç NL ‚Üí SQL        ‚îÇ
‚îÇ - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ–º–ø—Ç –≤ Ollama ‚îÇ
‚îÇ   Cloud API —Å API Key         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Ollama Cloud + SQLCoder       ‚îÇ
‚îÇ - –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è SQL –º–æ–¥–µ–ª—å‚îÇ
‚îÇ - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –∑–∞–ø—Ä–æ—Å       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SQL Validator                 ‚îÇ
‚îÇ - –ü—Ä–æ–≤–µ—Ä–∫–∞: —Ç–æ–ª—å–∫–æ SELECT     ‚îÇ
‚îÇ - –ë–ª–æ–∫–∏—Ä—É–µ—Ç DROP/DELETE/UPDATE‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ PostgreSQL (readonly user)    ‚îÇ
‚îÇ - –í—ã–ø–æ–ª–Ω—è–µ—Ç SELECT –∑–∞–ø—Ä–æ—Å     ‚îÇ
‚îÇ - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ User –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

```sql
"–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –≤–∏–¥–µ–æ –µ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ?"
‚Üí SELECT COUNT(*) FROM videos

"–°–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –Ω–∞–±—Ä–∞–ª–æ –±–æ–ª—å—à–µ 100000 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤?"
‚Üí SELECT COUNT(*) FROM videos WHERE views_count > 100000

"–ù–∞ —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤—ã—Ä–æ—Å–ª–∏ –≤—Å–µ –≤–∏–¥–µ–æ 28 –Ω–æ—è–±—Ä—è 2025?"
‚Üí SELECT COALESCE(SUM(delta_views_count), 0) 
   FROM video_snapshots 
   WHERE DATE(created_at) = '2025-11-28'
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. **Telegram Bot** (`app/bot.py`)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç aiogram 3.x (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã `/start`, `/help`
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

#### 2. **LLM Processor** (`app/llm_processor.py`)
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫ ‚Üí SQL
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Ollama + Qwen3-coder (–æ–±–ª–∞—á–Ω—ã–π)
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SQL


**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

-  **–ü—Ä–æ–º–ø—Ç-–∏–Ω–∂–µ–Ω–µ—Ä–∏–Ω–≥**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î + –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
-  **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç**: "28 –Ω–æ—è–±—Ä—è 2025" ‚Üí "2025-11-28"
-  **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –¢–æ–ª—å–∫–æ SELECT –∑–∞–ø—Ä–æ—Å—ã, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

  

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è Qwen3-Coder:**

```
### Task
Generate a SQL query to answer: "–°–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –Ω–∞–±—Ä–∞–ª–æ –±–æ–ª—å—à–µ 100000 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤?"

### Database Schema
CREATE TABLE videos (
id VARCHAR(36) PRIMARY KEY,
creator_id VARCHAR(32) NOT NULL,
views_count BIGINT NOT NULL,
...
);

### Instructions
- Return ONLY the SQL query
- The query must return a single number
- Use COALESCE for NULL handling

### Examples
Question: "How many videos got more than 100000 views?"
SQL: SELECT COUNT(*) FROM videos WHERE views_count > 100000
...

### SQL Query
```

#### 3. **Database Layer** (`app/db.py`)

  

- SQLAlchemy 2.0 —Å asyncpg (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL)

-  **–î–≤–∞ —Ä–µ–∂–∏–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**

-  **Admin** (–¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö) - –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞

-  **Readonly** (–¥–ª—è –±–æ—Ç–∞) - —Ç–æ–ª—å–∫–æ SELECT

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î:**

```python
# –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç readonly –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
db.init(use_admin=False)

# –î–∞–∂–µ –µ—Å–ª–∏ LLM —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç DROP TABLE
# PostgreSQL –æ—Ç–∫–∞–∂–µ—Ç: "permission denied"
```

#### 4. **Models** (`app/models.py`)

- SQLAlchemy ORM –º–æ–¥–µ–ª–∏
- –î–≤–µ —Ç–∞–±–ª–∏—Ü—ã: `videos` –∏ `video_snapshots`
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤


## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

  

### –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–º–æ—á–∏–π (Principle of Least Privilege)

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–¥–≤–∞ PostgreSQL –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:

1.  **Admin** (`admin:admin_password`)
- –ü–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ –ë–î
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è:
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π (`migrations` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
- –ó–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö (`data-loader` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)

2.  **Readonly** (`readonly_user:readonly_password`)
- –¢–æ–ª—å–∫–æ `SELECT` –Ω–∞ –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–æ—Ç–æ–º –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
-  **–ù–ï –ú–û–ñ–ï–¢** –≤—ã–ø–æ–ª–Ω–∏—Ç—å `INSERT`, `UPDATE`, `DELETE`, `DROP`

### –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∑–∞—â–∏—Ç–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –£—Ä–æ–≤–µ–Ω—å 1: SQL Validator (Python)   ‚îÇ
‚îÇ - –ë–ª–æ–∫–∏—Ä—É–µ—Ç –Ω–µ-SELECT –∑–∞–ø—Ä–æ—Å—ã       ‚îÇ
‚îÇ - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–ø–∞—Å–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –£—Ä–æ–≤–µ–Ω—å 2: PostgreSQL permissions   ‚îÇ
‚îÇ - Readonly user —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –Ω–µ –º–æ–∂–µ—Ç  ‚îÇ
‚îÇ –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–∏–º–µ—Ä:**

–ï—Å–ª–∏ LLM –æ—à–∏–±—ë—Ç—Å—è –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:

```sql
DELETE  FROM videos WHERE id = '123'
```

1. SQL Validator –æ—Ç–∫–∞–∂–µ—Ç: "Non-SELECT query rejected"
2. –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –ø—Ä–æ–ø—É—Å—Ç–∏—Ç ‚Üí PostgreSQL –æ—Ç–∫–∞–∂–µ—Ç: "permission denied for table videos"
 
## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

–ë–æ—Ç –ø–æ–Ω–∏–º–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º:

```sql
"–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –≤–∏–¥–µ–æ –µ—Å—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ?"
‚Üí SELECT COUNT(*) FROM videos;

"–°–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ –Ω–∞–±—Ä–∞–ª–æ –±–æ–ª—å—à–µ 100000 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤?"
‚Üí SELECT COUNT(*) FROM videos WHERE views_count > 100000;

"–ù–∞ —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤—ã—Ä–æ—Å–ª–∏ –≤—Å–µ –≤–∏–¥–µ–æ 28 –Ω–æ—è–±—Ä—è 2025?"
‚Üí SELECT COALESCE(SUM(delta_views_count), 0) 
   FROM video_snapshots 
   WHERE DATE(created_at) = '2025-11-28';
```
  

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ


### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë
docker-compose  up  -d

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker-compose  down

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose  logs  -f  bot

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
docker-compose  restart  bot

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose  ps
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ LLM –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
docker-compose  run  --rm  bot  pytest

# –¢–µ—Å—Ç—ã —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
docker-compose  run  --rm  bot  pytest  -v
```
